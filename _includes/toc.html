<ol>
{% for node in site.pages %}
	{% if node.title != nil and node.url != '/' %}
		{% capture nodediff %}{{ page.url | remove:node.url }}{% endcapture %}
		{% if node.isSubPage != true %}
			<li><a {% if nodediff != page.url %}class="active" {% endif %}href="{{site.baseurl}}{{ node.url }}">{{ node.title }}</a></li>
		{% endif %}
		{% if node.category == page.category %}
			{% for sec in node.sections %}
				
				{% capture subpages %} 
					{{ site.pages 
						| where: "isSubPage" , true 
						| where: "category", node.category
						| where: "subcategory", sec[0] }} 
				{% endcapture %}
				
				<ul>
				<li>{{sec[0]}}</li>
					{% if subpages != empty %}
						{% for subpage in subpages %}
							<li><a href="{{site.baseurl}}{{node.url}}{{ subpage.url }}">{{ sec[1] }}</a></li>
							
							{% for section in subpage.sections %}
								<ul>
									{% capture anker %}{{ section[1] | downcase | replace:' ','-' }}{% endcapture %}
									<li><a href="{{site.baseurl}}{{node.url}}#{{ anker }}">{{ section[1] }}</a></li>
								</ul>
							{% endfor %}
						{% endfor %}
					{% else %}
						{% capture anker %}{{ sec[1] | downcase | replace:' ','-' }}{% endcapture %}
						<li><a href="{{site.baseurl}}{{node.url}}#{{ anker }}">{{ sec[1] }}2</a></li>
					{% endif %}
				</ul>
			{% endfor %}
		{% endif %}
	{% endif %}
{% endfor %}
</ol>
